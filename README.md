<!-- README.md is generated from README.Rmd. Please edit that file -->
rprime
======

[![Build Status](https://travis-ci.org/tjmahr/rprime.svg)](https://travis-ci.org/tjmahr/rprime) [![Coverage Status](https://coveralls.io/repos/tjmahr/rprime/badge.svg)](https://coveralls.io/r/tjmahr/rprime)

`rprime` is an R package for parsing `.txt` generated by E-Prime, a program for running psychological experiments.

Overview
--------

The main workflow for working with `rprime` involves:

1.  `read_eprime`: reliably read in data from an Eprime log (`.txt`) file.
2.  `FrameList`: extract the text in each `"LogFrame"` in the file, storing each log-frame as an R list.
3.  `preview_levels`, `preview_eprime`: explore the structure of the parsed data.
4.  `keep_levels`, `drop_levels`, `filter_in`, `filter_out`: select and filter particular levels from the txt-file..
5.  `to_data_frame`: make a data-frame from the parsed data.

Examples
--------

Loading and parsing a file.

``` r
# Read in an Eprime text file
experiment_lines <- read_eprime("data/SAILS/SAILS_001X00XS1.txt")

# Extract and parse the log-frames from the file
experiment_data <- FrameList(experiment_lines)
```

Exploring and filtering frames from a file.

``` r
# Run-down of different log-frames in the FrameList
preview_levels(experiment_data)
#> Level Counts: 
#>  Eprime.Level       Running         Procedure freq
#>             1        Header            Header    1
#>             3 PracticeBlock PracticeTrialProc   10
#>             2  PracticeList      PracticeProc    1
#>             3    TrialLists         TrialProc   70
#>             2     BlockList         BlockProc    7
#>             1          <NA>              <NA>    1

# Filter (out) by depth of nesting
not_level_1 <- drop_levels(experiment_data, 1)
preview_levels(not_level_1)
#> Level Counts: 
#>  Eprime.Level       Running         Procedure freq
#>             3 PracticeBlock PracticeTrialProc   10
#>             2  PracticeList      PracticeProc    1
#>             3    TrialLists         TrialProc   70
#>             2     BlockList         BlockProc    7

# Filter (in) by depth of nesting
just_level_3 <- keep_levels(experiment_data, 3)

# Preview each kind of log-frame in the FrameList
preview_eprime(just_level_3)
#> Level Counts: 
#>  Eprime.Level       Running         Procedure freq
#>             3 PracticeBlock PracticeTrialProc   10
#>             3    TrialLists         TrialProc   70
#> 
#>  Eprime.Level       Running         Procedure
#>             3 PracticeBlock PracticeTrialProc
#> List of 25
#>  $ Eprime.Level            : num 3
#>  $ Eprime.LevelName        : chr "PracticeBlock_1"
#>  $ Eprime.Basename         : chr "SAILS_001X00XS1"
#>  $ Eprime.FrameNumber      : chr "2"
#>  $ Procedure               : chr "PracticeTrialProc"
#>  $ Running                 : chr "PracticeBlock"
#>  $ Practice                : chr "1"
#>  $ Sound                   : chr "LAKE1.WAV"
#>  $ Correct                 : chr "Word"
#>  $ Module                  : chr "LAKE"
#>  $ Color                   : chr "red"
#>  $ WordImage               : chr "lake"
#>  $ NonWordImage            : chr "notlake"
#>  $ PuzzleImage             : chr "up"
#>  $ Cycle                   : chr "1"
#>  $ Sample                  : chr "1"
#>  $ TrialSlide.OnsetDelay   : chr "197"
#>  $ TrialSlide.OnsetTime    : chr "899413"
#>  $ TrialSlide.DurationError: chr "-999999"
#>  $ TrialSlide.RTTime       : chr "0"
#>  $ TrialSlide.ACC          : chr "0"
#>  $ TrialSlide.RT           : chr "0"
#>  $ TrialSlide.RESP         : chr ""
#>  $ TrialSlide.CRESP        : chr ""
#>  $ Response                : chr "Word"
#>  - attr(*, "class")= chr [1:2] "EprimeFrame" "list"
#> 
#>  Eprime.Level    Running Procedure
#>             3 TrialLists TrialProc
#> List of 25
#>  $ Eprime.Level            : num 3
#>  $ Eprime.LevelName        : chr "TrialLists_1"
#>  $ Eprime.Basename         : chr "SAILS_001X00XS1"
#>  $ Eprime.FrameNumber      : chr "13"
#>  $ Procedure               : chr "TrialProc"
#>  $ Running                 : chr "TrialLists"
#>  $ Sound                   : chr "LAKE23B.WAV"
#>  $ Correct                 : chr "Word"
#>  $ LakeLevel1              : chr "8"
#>  $ Module                  : chr "LAKE"
#>  $ Color                   : chr "blue"
#>  $ WordImage               : chr "lake"
#>  $ NonWordImage            : chr "notlake"
#>  $ PuzzleImage             : chr "butterfly"
#>  $ TrialSlide.OnsetDelay   : chr "119"
#>  $ TrialSlide.OnsetTime    : chr "1023939"
#>  $ TrialSlide.DurationError: chr "-999999"
#>  $ TrialSlide.RTTime       : chr "0"
#>  $ TrialSlide.ACC          : chr "0"
#>  $ TrialSlide.RT           : chr "0"
#>  $ TrialSlide.RESP         : chr ""
#>  $ TrialSlide.CRESP        : chr ""
#>  $ Response                : chr "Word"
#>  $ Cycle                   : chr "1"
#>  $ Sample                  : chr "1"
#>  - attr(*, "class")= chr [1:2] "EprimeFrame" "list"

# Filter (out) by attribute values
no_header <- filter_out(experiment_data, "Running", values = "Header")
preview_levels(no_header)
#> Level Counts: 
#>  Eprime.Level       Running         Procedure freq
#>             3 PracticeBlock PracticeTrialProc   10
#>             2  PracticeList      PracticeProc    1
#>             3    TrialLists         TrialProc   70
#>             2     BlockList         BlockProc    7
#>             1          <NA>              <NA>    1

# Filter (in) by attribute values
not_practice <- filter_in(experiment_data, "Running", "TrialLists")
preview_eprime(not_practice)
#> Level Counts: 
#>  Eprime.Level    Running Procedure freq
#>             3 TrialLists TrialProc   70
#> 
#>  Eprime.Level    Running Procedure
#>             3 TrialLists TrialProc
#> List of 25
#>  $ Eprime.Level            : num 3
#>  $ Eprime.LevelName        : chr "TrialLists_1"
#>  $ Eprime.Basename         : chr "SAILS_001X00XS1"
#>  $ Eprime.FrameNumber      : chr "13"
#>  $ Procedure               : chr "TrialProc"
#>  $ Running                 : chr "TrialLists"
#>  $ Sound                   : chr "LAKE23B.WAV"
#>  $ Correct                 : chr "Word"
#>  $ LakeLevel1              : chr "8"
#>  $ Module                  : chr "LAKE"
#>  $ Color                   : chr "blue"
#>  $ WordImage               : chr "lake"
#>  $ NonWordImage            : chr "notlake"
#>  $ PuzzleImage             : chr "butterfly"
#>  $ TrialSlide.OnsetDelay   : chr "119"
#>  $ TrialSlide.OnsetTime    : chr "1023939"
#>  $ TrialSlide.DurationError: chr "-999999"
#>  $ TrialSlide.RTTime       : chr "0"
#>  $ TrialSlide.ACC          : chr "0"
#>  $ TrialSlide.RT           : chr "0"
#>  $ TrialSlide.RESP         : chr ""
#>  $ TrialSlide.CRESP        : chr ""
#>  $ Response                : chr "Word"
#>  $ Cycle                   : chr "1"
#>  $ Sample                  : chr "1"
#>  - attr(*, "class")= chr [1:2] "EprimeFrame" "list"

# Drill down into a FrameList
sue_trials <- filter_in(not_practice, "Module", "SUE")
preview_eprime(sue_trials)
#> Level Counts: 
#>  Eprime.Level    Running Procedure freq
#>             3 TrialLists TrialProc   30
#> 
#>  Eprime.Level    Running Procedure
#>             3 TrialLists TrialProc
#> List of 25
#>  $ Eprime.Level            : num 3
#>  $ Eprime.LevelName        : chr "TrialLists_5"
#>  $ Eprime.Basename         : chr "SAILS_001X00XS1"
#>  $ Eprime.FrameNumber      : chr "57"
#>  $ Procedure               : chr "TrialProc"
#>  $ Running                 : chr "TrialLists"
#>  $ Sound                   : chr "SUE4.WAV"
#>  $ Correct                 : chr "Word"
#>  $ SueLevel1               : chr "10"
#>  $ Module                  : chr "SUE"
#>  $ Color                   : chr "blue"
#>  $ WordImage               : chr "sue"
#>  $ NonWordImage            : chr "notsue"
#>  $ PuzzleImage             : chr "madagascar"
#>  $ TrialSlide.OnsetDelay   : chr "127"
#>  $ TrialSlide.OnsetTime    : chr "1360767"
#>  $ TrialSlide.DurationError: chr "-999999"
#>  $ TrialSlide.RTTime       : chr "0"
#>  $ TrialSlide.ACC          : chr "0"
#>  $ TrialSlide.RT           : chr "0"
#>  $ TrialSlide.RESP         : chr ""
#>  $ TrialSlide.CRESP        : chr ""
#>  $ Response                : chr "Word"
#>  $ Cycle                   : chr "1"
#>  $ Sample                  : chr "41"
#>  - attr(*, "class")= chr [1:2] "EprimeFrame" "list"
```

Convert to a dataframe.

``` r
# Export to dataframe
columns_to_keep <- c("Eprime.Basename", "Module", "Sample", 
                     "Correct", "Response")
sue_trials_df <- to_data_frame(sue_trials)[columns_to_keep]
head(sue_trials_df)
#>   Eprime.Basename Module Sample Correct Response
#> 1 SAILS_001X00XS1    SUE     41    Word     Word
#> 2 SAILS_001X00XS1    SUE     42 NotWord  NotWord
#> 3 SAILS_001X00XS1    SUE     43 NotWord     Word
#> 4 SAILS_001X00XS1    SUE     44    Word     Word
#> 5 SAILS_001X00XS1    SUE     45 NotWord  NotWord
#> 6 SAILS_001X00XS1    SUE     46    Word     Word
```
